<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Execute PSR-15 RequestHandlerInterface instances and emit responses they generate.">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Emitters - zend-httphandlerrunner</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/styles-288837cc22.css">

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
                <a href="..">zend-httphandlerrunner</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                
                    <li >
                        <a href="..">zend-httphandlerrunner</a>
                    </li>
                
                
                
                
                
                    <li >
                        <a href="../intro/">Introduction</a>
                    </li>
                
                
                
                
                
                    <li >
                        <a href="../usage/">Usage</a>
                    </li>
                
                
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../runner/">Request Handler Runner</a>
</li>


                        
                            

<li class="active">
    <a href="./">Emitters</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/zend-httphandlerrunner/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#emitters">Emitters</a></li>
        
            <li><a href="#sapiemitter">SapiEmitter</a></li>
        
            <li><a href="#sapistreamemitter">SapiStreamEmitter</a></li>
        
            <li><a href="#emitterstack">EmitterStack</a></li>
        
    
    </ul>

    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="..">zend-httphandlerrunner</a></li>
  
    
      
        <li>Reference</li>
      
    
  
  <li class="active">Emitters</li>
</ol>

<h1 id="emitters">Emitters</h1>
<p>Emitters are used to <em>emit</em> a <a href="https://www.php-fig.org/psr/psr-7">PSR-7</a>
response. This should generally happen when running under a traditional PHP
server API that uses output buffers, such as Apache or php-fpm.</p>
<p>Emitters are described by <code>Zend\HttpHandlerRunner\Emitter\EmitterInterface</code>:</p>
<pre class="codehilite"><code class="language-php">use Psr\Http\Message\ResponseInterface;

interface EmitterInterface
{
    public function emit(ResponseInterface $response) : bool;
}</code></pre>

<p>Typically, such emitters will perform the following:</p>
<ul>
<li>Emit a response status line.</li>
<li>Emit all response headers.</li>
<li>Emit the response body.</li>
</ul>
<p>(The first two items may be swapped in order; many SAPIs allow emitting multiple
status lines, and will use the last one present. As such, most implementations
will emit the status line after the headers to ensure the correct one is emitted
by the SAPI.)</p>
<p>The <code>emit()</code> method allows returning a boolean. This value can be checked to
determine if the emitter was able to emit the response. This capability is used
by the provided <code>EmitterStack</code> to allow composing multiple emitters that can
introspect the response to determine whether or not they are capable of emitting
it.</p>
<h2 id="sapiemitter">SapiEmitter</h2>
<p><code>Zend\HttpHandlerRunner\Emitter\SapiEmitter</code> accepts the response instance, and
uses the built-in PHP function <code>header()</code> to emit both the headers as well as
the status line. It then uses <code>echo</code> to emit the response body.</p>
<p>Internally, it also does a number of verifications:</p>
<ul>
<li>If headers have been previously sent, it will raise an exception.</li>
<li>If output has been previously sent, it will raise an exception.</li>
</ul>
<p>These are performed in order to ensure the integrity of the response emitted.</p>
<p>It also filters header names to normalize them; this is done in part to ensure
that if multiple headers of the same name are emitted, the SAPI will report them
correctly.</p>
<p>This emitter can <em>always</em> handle a response, and thus <em>always</em> returns true.</p>
<h2 id="sapistreamemitter">SapiStreamEmitter</h2>
<p><code>Zend\HttpHandlerRunner\Emitter\SapiStreamEmitter</code> behaves similarly to the
<code>SapiEmitter</code>, with two key differences:</p>
<ul>
<li>It allows emitting a a <em>content range</em>, if a <code>Content-Range</code> header is
  specified in the response.</li>
<li>It will iteratively emit a range of bytes from the response, based on the
  buffer length provided to the emitter during construction. This is
  particularly useful when returning <em>files</em> or <em>downloads</em>.</li>
</ul>
<p>The emitter accepts an integer argument to the constructor, indicating the
maximum buffer length; by default, this is 8192 bytes.</p>
<p>This emitter can <em>always</em> handle a response, and thus <em>always</em> returns true.</p>
<h2 id="emitterstack">EmitterStack</h2>
<p><code>Zend\HttpHandlerRunner\Emitter\EmitterStack</code> allows providing a
last-in-first-out (LIFO) stack of emitters instead of a single emitter. If an
emitter is incapable of handling the response and returns <code>false</code>, the stack
will move to the next emitter. If an emitter returns <code>true</code>, the stack
short-circuits and immediately returns.</p>
<p>The <code>EmitterStack</code> extends <code>SplStack</code>, and thus allows you to add emitters using
any of the methods that class defines; we recommend adding them in LIFO order
using <code>push()</code>:</p>
<pre class="codehilite"><code class="language-php">$stack-&gt;push($last);
$stack-&gt;push($second);
$stack-&gt;push($first);</code></pre>

<h3 id="conditionally-using-the-sapistreamemitter">Conditionally using the SapiStreamEmitter</h3>
<p>The <code>SapiStreamEmitter</code> is capable of emitting any response. However, for
in-memory responses, you may want to use the more efficient <code>SapiEmitter</code>. How
can you do this?</p>
<p>One way is to check for response artifacts that indicate a file download, such
as the <code>Content-Disposition</code> or <code>Content-Range</code> headers; if those headers are
not present, you could return <code>false</code> from the emitter, and otherwise continue.
You could achieve this by decorating the <code>SapiStreamEmitter</code>:</p>
<pre class="codehilite"><code class="language-php">$sapiStreamEmitter = new SapiStreamEmitter($maxBufferLength);
$conditionalEmitter = new class ($sapiStreamEmitter) implements EmitterInterface {
    private $emitter;

    public function __construct(EmitterInterface $emitter)
    {
        $this-&gt;emitter = $emitter;
    }

    public function emit(ResponseInterface) : bool
    {
        if (! $response-&gt;hasHeader('Content-Disposition')
            &amp;&amp; ! $response-&gt;hasHeader('Content-Range')
        ) {
            return false;
        }
        return $this-&gt;emitter-&gt;emit($response);
    }
};

$stack = new EmitterStack();
$stack-&gt;push(new SapiEmitter());
$stack-&gt;push($conditionalEmitter);</code></pre>

<p>In this way, you can have the best of both worlds, using the memory-efficient
<code>SapiStreamEmitter</code> for large file downloads or streaming buffers, and the
general-purpose <code>SapiEmitter</code> for everything else.</p>

<hr />

</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="https://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2017 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="https://discourse.zendframework.com" class="btn-social btn-outline" alt="Forum" title="Forum"><i class="fa fa-comments"></i></a>
                    <a href="https://zendframework-slack.herokuapp.com" class="btn-social btn-outline" alt="Slack" title="Slack"><i class="fa fa-slack"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script>var base_url = '..';</script>
    <script src="../js/scripts-0b6185f4a5.js"></script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="https://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

</body>


</html>
